#!/usr/bin/env sh

readonly PROJECT_DIRECTORY=$(realpath $(dirname $(realpath $0))/..)

set -e

if [ $(which docker || false) ]; then
    docker run \
        --rm \
        -e PHPCS_PARAMETERS="--warning-severity=0 --ignore=/var/phpcs/var,/var/phpcs/vendor/,/var/phpcs/config/bundles.php" \
        -e PHPCS_BOOTSTRAP=/var/phpcs.bootstrap.php \
        -v ${PROJECT_DIRECTORY}/src:/var/phpcs:ro \
        -v ${PROJECT_DIRECTORY}/phpcs.bootstrap.php:/var/phpcs.bootstrap.php:ro \
        steevanb/php-code-sniffs:2.0.10
else
    vendor/bin/phpcs \
        --warning-severity=0 \
        --ignore=/var/phpcs/var,/var/phpcs/vendor/,/var/phpcs/config/bundles.php \
        --ignore=/var/phpcs/vendor/ \
        --standard=${PROJECT_DIRECTORY}/vendor/steevanb/php-code-sniffs/Steevanb/ruleset.xml \
        --report=steevanb\\PhpCodeSniffs\\Reports\\Steevanb \
        src
fi
